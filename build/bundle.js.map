{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/core/Control.js","src/core/Game.js","src/core/InternalPlayer.js","src/drawers/WebDrawer.js","src/log/Logger.js","src/players/sample-player.js","src/utils/Utils.js","src/web.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const Operations = {\n  NONE: 'none',\n  MOVE: 'move',\n  ROTATE: 'rotate'\n}\n\nclass Control {\n\n  constructor() {\n    this.angle = 0\n    this.velocity = 0\n    this.operation = Operations.NONE\n  }\n\n  move(velocity) {\n    this.velocity = velocity\n    this.operation = Operations.MOVE\n  }\n\n  rotate(angle) {\n    this.angle += angle\n    this.operation = Operations.ROTATE\n  }\n}\n\nmodule.exports = {\n  Control, Operations\n}","// import { SamplePlayer } from \"../players/sample-player\"\nconst InternalPlayer = require('./InternalPlayer')\nconst Utils = require('../utils/Utils')\nconst SamplePlayer = require('../players/sample-player')\n\nclass Game {\n  constructor(drawer, logger) {\n    this.players = []\n    this.board = Utils.createMultiArray(8,5)\n    this.drawer = drawer\n    this.logger = logger\n    this.paused = false\n    this.ended = false\n    this.turnNumber = 0\n  }\n\n  addPlayer(player) {\n    this.players.push(\n      new InternalPlayer(player, this.board[0].length, this.board.length, this.logger)\n    )\n  }\n\n  init() {\n    console.log('GAME INIT')\n\n    this.players.forEach(p => p.doInit(\n      Utils.randomInt(this.board.length),\n      Utils.randomInt(this.board.length),\n      100\n    ))\n\n    this.drawer.init(this.players, this.board)\n  }\n\n  async start() {\n    console.log('GAME START')\n\n    while (!this.ended) {\n      this.turn()\n\n      this.turnNumber++\n      // if (this.turnNumber > 10) {\n      //   this.ended = true\n      // }\n      await this.sleep(1000)\n    }\n  }\n\n  sleep(ms) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, ms);\n    });\n  }\n\n  pause() {\n    this.paused = true\n  }\n\n  turn() {\n    this.players.forEach(p => p.doTurn())\n\n    this.drawer.draw()\n  }\n}\n\nmodule.exports = Game","const { Control, Operations } = require('./Control')\nconst Utils = require('../utils/Utils')\n\nclass InternalPlayer {\n  constructor(player, width, height, logger) {\n    this.x = 0\n    this.y = 0\n    this.angle = 0\n    this.life = 100\n    this.width = width\n    this.height = height\n    this.player = player\n    this.logger = logger\n  }\n\n  doInit(x, y, life) {\n    this.x = x\n    this.y = y\n    this.life = life\n    this.player.init()\n  }\n\n  doTurn() {\n    let control = new Control()\n    this.player.turn(control)\n\n    this.logger.debug(`CONTROL ${JSON.stringify(control)}`)\n    this.logger.debug(`PLAYER ${JSON.stringify(this)}`)\n\n    switch(control.operation) {\n      case Operations.NONE:\n        this.logger.debug('NONE operation');\n        break;\n      case Operations.MOVE:\n        this.logger.debug('MOVE operation');\n        this.move(control)\n        break;\n      case Operations.ROTATE:\n        this.logger.debug('ROTATE operation');\n        this.rotate(control)\n        break;\n      default:\n        this.logger.debug('NOOP')\n    }\n  }\n\n  rotate(control) {\n    if (control.angle !== 90 && control.angle !== 180 && control.angle !== 270 &&\n        control.angle !== -90 && control.angle !== -180 && control.angle !== -270) {\n          console.error('angle should be +-(90,180,270)')\n    } else {\n      this.angle += control.angle\n      this.angle = Utils.normalizeAngle(this.angle)\n    }\n  }\n\n  move(control) {\n    switch(this.angle) {\n      case 0:\n        if (this.x + control.velocity < this.width) {\n          this.x += control.velocity\n        }\n        break\n      case 180:\n        if (this.x - control.velocity >= 0) {\n          this.x -= control.velocity\n        }\n        break\n      case 90:\n        if (this.y - control.velocity >= 0) {\n          this.y -= control.velocity\n        }\n        break\n      case 270:\n        if (this.y + control.velocity < this.height) {\n          this.y += control.velocity\n        }\n        break\n    }\n  }\n}\n\nmodule.exports = InternalPlayer","class WebDrawer {\n  constructor(players, board) {\n    this.board = null\n    this.players = null\n\n    // TODO: externalize this\n    this.c = document.getElementById(\"myCanvas\");\n    this.ctx = this.c.getContext(\"2d\");\n  }\n\n  init(players, board) {\n    this.board = board\n    this.players = players\n  }\n\n  draw() {\n    // console.clear()\n    for (let i = 0; i<this.board[0].length; i++) {\n      // process.stdout.write(' ' + i)\n    }\n    // console.log('')\n    // let drawing = new Image()\n    // drawing.src = \"http://localhost:8080/sand/slice33_33.png\"\n    // this.ctx.drawImage(drawing, 0, 0, 70, 70);\n    this.ctx.clearRect(0, 0, this.ctx.width, this.ctx.height)\n\n    for (let i = 0; i<this.board.length; i++) {\n      for (let j = 0; j<this.board[i].length; j++) {\n        // console.log(' # ')\n        let player = this.anyPlayer(j, i)\n        if (player) {\n          this.ctx.fillStyle = \"#00FF00\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          // this.ctx.drawImage(drawing,j*70, i*70, 70, 70);\n\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/players/tank.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 20, 20);\n          }\n\n          if (player.angle === 0) {\n            // process.stdout.write(' > ')\n          }\n          if (player.angle === 90) {\n            // process.stdout.write(' ^ ')\n          }\n          if (player.angle === 180) {\n            // process.stdout.write(' < ')\n          }\n          if (player.angle === 270) {\n            // process.stdout.write(' v ')\n          }\n        } else {\n          this.ctx.fillStyle = \"#FF0000\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/sand/slice33_33.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 50, 50);\n          }\n\n          // process.stdout.write(' # ')\n        }\n      }\n      // console.log('')\n    }\n  }\n\n  anyPlayer(x, y) {\n    return this.players.find(p => p.x == x && p.y == y)\n  }\n}\n\nmodule.exports = WebDrawer","const INFO = 3\nconst DEBUG = 2\n\nclass Logger {\n  constructor(idHtmlLog, level) {\n    this.el = document.getElementById(idHtmlLog)\n    this.level = level\n    this.msgs = []\n  }\n\n  info(msg) {\n    this.msgs.push({ level: INFO, msg: msg })\n    this.flush()\n  }\n\n  debug(msg) {\n    this.msgs.push({ level: DEBUG, msg: msg })\n    this.flush()\n  }\n\n  flush() {\n    this.msgs.forEach(msg => this.el.innerHTML += `${msg.level}: ${msg.msg}\\n`)\n    this.el.scrollTop = this.el.scrollHeight;\n    this.msgs = []\n  }\n}\n\nmodule.exports = Logger","const Utils = require('../utils/Utils')\n\nclass SamplePlayer {\n  constructor() {\n    this.turnNumber = 0\n  }\n\n  init() {\n    console.log(`init`)\n  }\n\n  turn(control) {\n    console.log(`turn`)\n\n    if (this.turnNumber % 4 === 0) {\n      control.rotate(90)\n    } else {\n      control.move(1)\n    }\n\n    this.turnNumber++\n  }\n}\n\nmodule.exports = SamplePlayer","function randomInt(max) {\n  return parseInt(Math.random() * max)\n}\n\nfunction normalizeAngle(angle) {\n  if (angle >= 360) {\n    return angle - 360\n  }\n  if (angle < 0) {\n    return 360 - angle\n  }\n\n  return angle\n}\n\nfunction createMultiArray(width, height) {\n  let row = new Array(width).fill(0)\n  let array = new Array(height).fill(row)\n\n  return array\n}\n\nmodule.exports = { randomInt, normalizeAngle, createMultiArray }","const Game = require('./core/Game.js')\nconst WebDrawer = require('./drawers/WebDrawer.js')\nconst SamplePlayer = require('./players/sample-player.js')\nconst Logger = require('./log/Logger.js')\n\n// console.log('Started...')\n\n// let game = new Game(new WebDrawer())\n\n// // add players\n// game.addPlayer(new SamplePlayer())\n// game.addPlayer(new SamplePlayer())\n\n// // init\n// game.init()\n\n// // start\n// game.start()\n\nmodule.exports = { Game, WebDrawer, SamplePlayer, Logger }\n\n// module.exports = {\n//   Game: require('./core/Game.js')\n// }\n\n// exports.Game = require('./core/Game.js')\n\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29yZS9Db250cm9sLmpzIiwic3JjL2NvcmUvR2FtZS5qcyIsInNyYy9jb3JlL0ludGVybmFsUGxheWVyLmpzIiwic3JjL2RyYXdlcnMvV2ViRHJhd2VyLmpzIiwic3JjL2xvZy9Mb2dnZXIuanMiLCJzcmMvcGxheWVycy9zYW1wbGUtcGxheWVyLmpzIiwic3JjL3V0aWxzL1V0aWxzLmpzIiwic3JjL3dlYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IE9wZXJhdGlvbnMgPSB7XG4gIE5PTkU6ICdub25lJyxcbiAgTU9WRTogJ21vdmUnLFxuICBST1RBVEU6ICdyb3RhdGUnXG59XG5cbmNsYXNzIENvbnRyb2wge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYW5nbGUgPSAwXG4gICAgdGhpcy52ZWxvY2l0eSA9IDBcbiAgICB0aGlzLm9wZXJhdGlvbiA9IE9wZXJhdGlvbnMuTk9ORVxuICB9XG5cbiAgbW92ZSh2ZWxvY2l0eSkge1xuICAgIHRoaXMudmVsb2NpdHkgPSB2ZWxvY2l0eVxuICAgIHRoaXMub3BlcmF0aW9uID0gT3BlcmF0aW9ucy5NT1ZFXG4gIH1cblxuICByb3RhdGUoYW5nbGUpIHtcbiAgICB0aGlzLmFuZ2xlICs9IGFuZ2xlXG4gICAgdGhpcy5vcGVyYXRpb24gPSBPcGVyYXRpb25zLlJPVEFURVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBDb250cm9sLCBPcGVyYXRpb25zXG59IiwiLy8gaW1wb3J0IHsgU2FtcGxlUGxheWVyIH0gZnJvbSBcIi4uL3BsYXllcnMvc2FtcGxlLXBsYXllclwiXG5jb25zdCBJbnRlcm5hbFBsYXllciA9IHJlcXVpcmUoJy4vSW50ZXJuYWxQbGF5ZXInKVxuY29uc3QgVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy9VdGlscycpXG5jb25zdCBTYW1wbGVQbGF5ZXIgPSByZXF1aXJlKCcuLi9wbGF5ZXJzL3NhbXBsZS1wbGF5ZXInKVxuXG5jbGFzcyBHYW1lIHtcbiAgY29uc3RydWN0b3IoZHJhd2VyLCBsb2dnZXIpIHtcbiAgICB0aGlzLnBsYXllcnMgPSBbXVxuICAgIHRoaXMuYm9hcmQgPSBVdGlscy5jcmVhdGVNdWx0aUFycmF5KDgsNSlcbiAgICB0aGlzLmRyYXdlciA9IGRyYXdlclxuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyXG4gICAgdGhpcy5wYXVzZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5kZWQgPSBmYWxzZVxuICAgIHRoaXMudHVybk51bWJlciA9IDBcbiAgfVxuXG4gIGFkZFBsYXllcihwbGF5ZXIpIHtcbiAgICB0aGlzLnBsYXllcnMucHVzaChcbiAgICAgIG5ldyBJbnRlcm5hbFBsYXllcihwbGF5ZXIsIHRoaXMuYm9hcmRbMF0ubGVuZ3RoLCB0aGlzLmJvYXJkLmxlbmd0aCwgdGhpcy5sb2dnZXIpXG4gICAgKVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICBjb25zb2xlLmxvZygnR0FNRSBJTklUJylcblxuICAgIHRoaXMucGxheWVycy5mb3JFYWNoKHAgPT4gcC5kb0luaXQoXG4gICAgICBVdGlscy5yYW5kb21JbnQodGhpcy5ib2FyZC5sZW5ndGgpLFxuICAgICAgVXRpbHMucmFuZG9tSW50KHRoaXMuYm9hcmQubGVuZ3RoKSxcbiAgICAgIDEwMFxuICAgICkpXG5cbiAgICB0aGlzLmRyYXdlci5pbml0KHRoaXMucGxheWVycywgdGhpcy5ib2FyZClcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0KCkge1xuICAgIGNvbnNvbGUubG9nKCdHQU1FIFNUQVJUJylcblxuICAgIHdoaWxlICghdGhpcy5lbmRlZCkge1xuICAgICAgdGhpcy50dXJuKClcblxuICAgICAgdGhpcy50dXJuTnVtYmVyKytcbiAgICAgIC8vIGlmICh0aGlzLnR1cm5OdW1iZXIgPiAxMCkge1xuICAgICAgLy8gICB0aGlzLmVuZGVkID0gdHJ1ZVxuICAgICAgLy8gfVxuICAgICAgYXdhaXQgdGhpcy5zbGVlcCgxMDAwKVxuICAgIH1cbiAgfVxuXG4gIHNsZWVwKG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKTtcbiAgICB9KTtcbiAgfVxuXG4gIHBhdXNlKCkge1xuICAgIHRoaXMucGF1c2VkID0gdHJ1ZVxuICB9XG5cbiAgdHVybigpIHtcbiAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHAuZG9UdXJuKCkpXG5cbiAgICB0aGlzLmRyYXdlci5kcmF3KClcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWUiLCJjb25zdCB7IENvbnRyb2wsIE9wZXJhdGlvbnMgfSA9IHJlcXVpcmUoJy4vQ29udHJvbCcpXG5jb25zdCBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL1V0aWxzJylcblxuY2xhc3MgSW50ZXJuYWxQbGF5ZXIge1xuICBjb25zdHJ1Y3RvcihwbGF5ZXIsIHdpZHRoLCBoZWlnaHQsIGxvZ2dlcikge1xuICAgIHRoaXMueCA9IDBcbiAgICB0aGlzLnkgPSAwXG4gICAgdGhpcy5hbmdsZSA9IDBcbiAgICB0aGlzLmxpZmUgPSAxMDBcbiAgICB0aGlzLndpZHRoID0gd2lkdGhcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodFxuICAgIHRoaXMucGxheWVyID0gcGxheWVyXG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXJcbiAgfVxuXG4gIGRvSW5pdCh4LCB5LCBsaWZlKSB7XG4gICAgdGhpcy54ID0geFxuICAgIHRoaXMueSA9IHlcbiAgICB0aGlzLmxpZmUgPSBsaWZlXG4gICAgdGhpcy5wbGF5ZXIuaW5pdCgpXG4gIH1cblxuICBkb1R1cm4oKSB7XG4gICAgbGV0IGNvbnRyb2wgPSBuZXcgQ29udHJvbCgpXG4gICAgdGhpcy5wbGF5ZXIudHVybihjb250cm9sKVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYENPTlRST0wgJHtKU09OLnN0cmluZ2lmeShjb250cm9sKX1gKVxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBQTEFZRVIgJHtKU09OLnN0cmluZ2lmeSh0aGlzKX1gKVxuXG4gICAgc3dpdGNoKGNvbnRyb2wub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlIE9wZXJhdGlvbnMuTk9ORTpcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ05PTkUgb3BlcmF0aW9uJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBPcGVyYXRpb25zLk1PVkU6XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdNT1ZFIG9wZXJhdGlvbicpO1xuICAgICAgICB0aGlzLm1vdmUoY29udHJvbClcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIE9wZXJhdGlvbnMuUk9UQVRFOlxuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnUk9UQVRFIG9wZXJhdGlvbicpO1xuICAgICAgICB0aGlzLnJvdGF0ZShjb250cm9sKVxuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdOT09QJylcbiAgICB9XG4gIH1cblxuICByb3RhdGUoY29udHJvbCkge1xuICAgIGlmIChjb250cm9sLmFuZ2xlICE9PSA5MCAmJiBjb250cm9sLmFuZ2xlICE9PSAxODAgJiYgY29udHJvbC5hbmdsZSAhPT0gMjcwICYmXG4gICAgICAgIGNvbnRyb2wuYW5nbGUgIT09IC05MCAmJiBjb250cm9sLmFuZ2xlICE9PSAtMTgwICYmIGNvbnRyb2wuYW5nbGUgIT09IC0yNzApIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdhbmdsZSBzaG91bGQgYmUgKy0oOTAsMTgwLDI3MCknKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFuZ2xlICs9IGNvbnRyb2wuYW5nbGVcbiAgICAgIHRoaXMuYW5nbGUgPSBVdGlscy5ub3JtYWxpemVBbmdsZSh0aGlzLmFuZ2xlKVxuICAgIH1cbiAgfVxuXG4gIG1vdmUoY29udHJvbCkge1xuICAgIHN3aXRjaCh0aGlzLmFuZ2xlKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIGlmICh0aGlzLnggKyBjb250cm9sLnZlbG9jaXR5IDwgdGhpcy53aWR0aCkge1xuICAgICAgICAgIHRoaXMueCArPSBjb250cm9sLnZlbG9jaXR5XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgMTgwOlxuICAgICAgICBpZiAodGhpcy54IC0gY29udHJvbC52ZWxvY2l0eSA+PSAwKSB7XG4gICAgICAgICAgdGhpcy54IC09IGNvbnRyb2wudmVsb2NpdHlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSA5MDpcbiAgICAgICAgaWYgKHRoaXMueSAtIGNvbnRyb2wudmVsb2NpdHkgPj0gMCkge1xuICAgICAgICAgIHRoaXMueSAtPSBjb250cm9sLnZlbG9jaXR5XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgMjcwOlxuICAgICAgICBpZiAodGhpcy55ICsgY29udHJvbC52ZWxvY2l0eSA8IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgdGhpcy55ICs9IGNvbnRyb2wudmVsb2NpdHlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEludGVybmFsUGxheWVyIiwiY2xhc3MgV2ViRHJhd2VyIHtcbiAgY29uc3RydWN0b3IocGxheWVycywgYm9hcmQpIHtcbiAgICB0aGlzLmJvYXJkID0gbnVsbFxuICAgIHRoaXMucGxheWVycyA9IG51bGxcblxuICAgIC8vIFRPRE86IGV4dGVybmFsaXplIHRoaXNcbiAgICB0aGlzLmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm15Q2FudmFzXCIpO1xuICAgIHRoaXMuY3R4ID0gdGhpcy5jLmdldENvbnRleHQoXCIyZFwiKTtcbiAgfVxuXG4gIGluaXQocGxheWVycywgYm9hcmQpIHtcbiAgICB0aGlzLmJvYXJkID0gYm9hcmRcbiAgICB0aGlzLnBsYXllcnMgPSBwbGF5ZXJzXG4gIH1cblxuICBkcmF3KCkge1xuICAgIC8vIGNvbnNvbGUuY2xlYXIoKVxuICAgIGZvciAobGV0IGkgPSAwOyBpPHRoaXMuYm9hcmRbMF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCcgJyArIGkpXG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKCcnKVxuICAgIC8vIGxldCBkcmF3aW5nID0gbmV3IEltYWdlKClcbiAgICAvLyBkcmF3aW5nLnNyYyA9IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwL3NhbmQvc2xpY2UzM18zMy5wbmdcIlxuICAgIC8vIHRoaXMuY3R4LmRyYXdJbWFnZShkcmF3aW5nLCAwLCAwLCA3MCwgNzApO1xuICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmN0eC53aWR0aCwgdGhpcy5jdHguaGVpZ2h0KVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGk8dGhpcy5ib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGo8dGhpcy5ib2FyZFtpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnICMgJylcbiAgICAgICAgbGV0IHBsYXllciA9IHRoaXMuYW55UGxheWVyKGosIGkpXG4gICAgICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcIiMwMEZGMDBcIlxuICAgICAgICAgIC8vIHRoaXMuY3R4LmZpbGxSZWN0KGoqMTArMSwgaSoxMCsxLCA4LCA4IClcbiAgICAgICAgICAvLyB0aGlzLmN0eC5kcmF3SW1hZ2UoZHJhd2luZyxqKjcwLCBpKjcwLCA3MCwgNzApO1xuXG4gICAgICAgICAgbGV0IGRyYXdpbmcgPSBuZXcgSW1hZ2UoKVxuICAgICAgICAgIGRyYXdpbmcuc3JjID0gXCJodHRwOi8vbG9jYWxob3N0OjgwODAvaW1nL3BsYXllcnMvdGFuay5wbmdcIlxuICAgICAgICAgIGRyYXdpbmcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGRyYXdpbmcsaio3MCsxLCBpKjcwKzEsIDIwLCAyMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMCkge1xuICAgICAgICAgICAgLy8gcHJvY2Vzcy5zdGRvdXQud3JpdGUoJyA+ICcpXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwbGF5ZXIuYW5nbGUgPT09IDkwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIF4gJylcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMTgwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIDwgJylcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMjcwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIHYgJylcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gXCIjRkYwMDAwXCJcbiAgICAgICAgICAvLyB0aGlzLmN0eC5maWxsUmVjdChqKjEwKzEsIGkqMTArMSwgOCwgOCApXG4gICAgICAgICAgbGV0IGRyYXdpbmcgPSBuZXcgSW1hZ2UoKVxuICAgICAgICAgIGRyYXdpbmcuc3JjID0gXCJodHRwOi8vbG9jYWxob3N0OjgwODAvaW1nL3NhbmQvc2xpY2UzM18zMy5wbmdcIlxuICAgICAgICAgIGRyYXdpbmcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGRyYXdpbmcsaio3MCsxLCBpKjcwKzEsIDUwLCA1MCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcHJvY2Vzcy5zdGRvdXQud3JpdGUoJyAjICcpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKCcnKVxuICAgIH1cbiAgfVxuXG4gIGFueVBsYXllcih4LCB5KSB7XG4gICAgcmV0dXJuIHRoaXMucGxheWVycy5maW5kKHAgPT4gcC54ID09IHggJiYgcC55ID09IHkpXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBXZWJEcmF3ZXIiLCJjb25zdCBJTkZPID0gM1xuY29uc3QgREVCVUcgPSAyXG5cbmNsYXNzIExvZ2dlciB7XG4gIGNvbnN0cnVjdG9yKGlkSHRtbExvZywgbGV2ZWwpIHtcbiAgICB0aGlzLmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRIdG1sTG9nKVxuICAgIHRoaXMubGV2ZWwgPSBsZXZlbFxuICAgIHRoaXMubXNncyA9IFtdXG4gIH1cblxuICBpbmZvKG1zZykge1xuICAgIHRoaXMubXNncy5wdXNoKHsgbGV2ZWw6IElORk8sIG1zZzogbXNnIH0pXG4gICAgdGhpcy5mbHVzaCgpXG4gIH1cblxuICBkZWJ1Zyhtc2cpIHtcbiAgICB0aGlzLm1zZ3MucHVzaCh7IGxldmVsOiBERUJVRywgbXNnOiBtc2cgfSlcbiAgICB0aGlzLmZsdXNoKClcbiAgfVxuXG4gIGZsdXNoKCkge1xuICAgIHRoaXMubXNncy5mb3JFYWNoKG1zZyA9PiB0aGlzLmVsLmlubmVySFRNTCArPSBgJHttc2cubGV2ZWx9OiAke21zZy5tc2d9XFxuYClcbiAgICB0aGlzLmVsLnNjcm9sbFRvcCA9IHRoaXMuZWwuc2Nyb2xsSGVpZ2h0O1xuICAgIHRoaXMubXNncyA9IFtdXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMb2dnZXIiLCJjb25zdCBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL1V0aWxzJylcblxuY2xhc3MgU2FtcGxlUGxheWVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50dXJuTnVtYmVyID0gMFxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICBjb25zb2xlLmxvZyhgaW5pdGApXG4gIH1cblxuICB0dXJuKGNvbnRyb2wpIHtcbiAgICBjb25zb2xlLmxvZyhgdHVybmApXG5cbiAgICBpZiAodGhpcy50dXJuTnVtYmVyICUgNCA9PT0gMCkge1xuICAgICAgY29udHJvbC5yb3RhdGUoOTApXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRyb2wubW92ZSgxKVxuICAgIH1cblxuICAgIHRoaXMudHVybk51bWJlcisrXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTYW1wbGVQbGF5ZXIiLCJmdW5jdGlvbiByYW5kb21JbnQobWF4KSB7XG4gIHJldHVybiBwYXJzZUludChNYXRoLnJhbmRvbSgpICogbWF4KVxufVxuXG5mdW5jdGlvbiBub3JtYWxpemVBbmdsZShhbmdsZSkge1xuICBpZiAoYW5nbGUgPj0gMzYwKSB7XG4gICAgcmV0dXJuIGFuZ2xlIC0gMzYwXG4gIH1cbiAgaWYgKGFuZ2xlIDwgMCkge1xuICAgIHJldHVybiAzNjAgLSBhbmdsZVxuICB9XG5cbiAgcmV0dXJuIGFuZ2xlXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU11bHRpQXJyYXkod2lkdGgsIGhlaWdodCkge1xuICBsZXQgcm93ID0gbmV3IEFycmF5KHdpZHRoKS5maWxsKDApXG4gIGxldCBhcnJheSA9IG5ldyBBcnJheShoZWlnaHQpLmZpbGwocm93KVxuXG4gIHJldHVybiBhcnJheVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgcmFuZG9tSW50LCBub3JtYWxpemVBbmdsZSwgY3JlYXRlTXVsdGlBcnJheSB9IiwiY29uc3QgR2FtZSA9IHJlcXVpcmUoJy4vY29yZS9HYW1lLmpzJylcbmNvbnN0IFdlYkRyYXdlciA9IHJlcXVpcmUoJy4vZHJhd2Vycy9XZWJEcmF3ZXIuanMnKVxuY29uc3QgU2FtcGxlUGxheWVyID0gcmVxdWlyZSgnLi9wbGF5ZXJzL3NhbXBsZS1wbGF5ZXIuanMnKVxuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi9sb2cvTG9nZ2VyLmpzJylcblxuLy8gY29uc29sZS5sb2coJ1N0YXJ0ZWQuLi4nKVxuXG4vLyBsZXQgZ2FtZSA9IG5ldyBHYW1lKG5ldyBXZWJEcmF3ZXIoKSlcblxuLy8gLy8gYWRkIHBsYXllcnNcbi8vIGdhbWUuYWRkUGxheWVyKG5ldyBTYW1wbGVQbGF5ZXIoKSlcbi8vIGdhbWUuYWRkUGxheWVyKG5ldyBTYW1wbGVQbGF5ZXIoKSlcblxuLy8gLy8gaW5pdFxuLy8gZ2FtZS5pbml0KClcblxuLy8gLy8gc3RhcnRcbi8vIGdhbWUuc3RhcnQoKVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgR2FtZSwgV2ViRHJhd2VyLCBTYW1wbGVQbGF5ZXIsIExvZ2dlciB9XG5cbi8vIG1vZHVsZS5leHBvcnRzID0ge1xuLy8gICBHYW1lOiByZXF1aXJlKCcuL2NvcmUvR2FtZS5qcycpXG4vLyB9XG5cbi8vIGV4cG9ydHMuR2FtZSA9IHJlcXVpcmUoJy4vY29yZS9HYW1lLmpzJylcblxuIl19"}