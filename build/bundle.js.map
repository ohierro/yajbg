{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/core/Control.js","src/core/Game.js","src/core/GameSnapshot.js","src/core/InternalPlayer.js","src/core/Misile.js","src/drawers/WebDrawer.js","src/log/Logger.js","src/players/sample-player.js","src/utils/Utils.js","src/web.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const Operations = {\n  NONE: 'none',\n  MOVE: 'move',\n  ROTATE: 'rotate',\n  SHOOT: 'shoot'\n}\n\nclass Control {\n\n  constructor() {\n    this.angle = 0\n    this.velocity = 0\n    this.operation = Operations.NONE\n  }\n\n  move(velocity) {\n    this.velocity = velocity\n    this.operation = Operations.MOVE\n  }\n\n  rotate(angle) {\n    this.angle += angle\n    this.operation = Operations.ROTATE\n  }\n\n  shoot() {\n    this.operation = Operations.SHOOT\n  }\n}\n\nmodule.exports = {\n  Control, Operations\n}","// import { SamplePlayer } from \"../players/sample-player\"\nconst InternalPlayer = require('./InternalPlayer')\nconst Utils = require('../utils/Utils')\nconst SamplePlayer = require('../players/sample-player')\nconst GameSnapshot = require('./GameSnapshot.js')\n\nclass Game {\n  constructor(drawer, logger) {\n    this.players = []\n    this.board = Utils.createMultiArray(8,5)\n    this.objects = []\n\n    this.drawer = drawer\n    this.logger = logger\n    this.paused = false\n    this.ended = false\n    this.turnNumber = 0\n  }\n\n  addPlayer(player) {\n    this.players.push(\n      new InternalPlayer(player, this.board[0].length, this.board.length, this.logger)\n    )\n  }\n\n  init() {\n    this.logger.info('GAME INIT')\n\n    this.players.forEach(p => p.doInit(\n      Utils.randomInt(this.board.length),\n      Utils.randomInt(this.board.length),\n      100\n    ))\n\n    this.drawer.init(this.players, this.board, this.objects)\n  }\n\n  async start() {\n    console.log('GAME START')\n\n    while (!this.ended) {\n      this.turn()\n\n      this.turnNumber++\n      // if (this.turnNumber > 10) {\n      //   this.ended = true\n      // }\n      await this.sleep(1000)\n    }\n  }\n\n  nextTick() {\n    this.logger.debug(`TURN ${this.turnNumber}`)\n\n    this.turn()\n\n    this.logger.debug(`OBJECTS ${this.objects}`)\n\n    this.turnNumber++\n  }\n\n  sleep(ms) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, ms);\n    });\n  }\n\n  pause() {\n    this.paused = true\n  }\n\n  turn() {\n    this.objects = []\n\n    this.players.forEach(p => {\n      let result = p.doTurn()\n\n      if (result !== null) {\n        this.objects.push(result)\n      }\n    })\n\n    this.drawer.draw2(new GameSnapshot(this.players, this.board, this.objects))\n  }\n}\n\nmodule.exports = Game","class GameSnapshot {\n  constructor(players, board, objects) {\n    this.players = players\n    this.board = board\n    this.objects = objects\n  }\n}\n\nmodule.exports = GameSnapshot","const { Control, Operations } = require('./Control')\nconst Utils = require('../utils/Utils')\nconst Misile = require('./Misile')\n\nclass InternalPlayer {\n  constructor(player, width, height, logger) {\n    this.x = 0\n    this.y = 0\n    this.angle = 0\n    this.life = 100\n    this.width = width\n    this.height = height\n    this.player = player\n    this.logger = logger\n  }\n\n  doInit(x, y, life) {\n    this.x = x\n    this.y = y\n    this.life = life\n    this.player.init()\n  }\n\n  doTurn() {\n    let control = new Control()\n    this.player.turn(control)\n\n    this.logger.debug(`CONTROL ${JSON.stringify(control)}`)\n    this.logger.debug(`PLAYER ${JSON.stringify(this)}`)\n\n    switch(control.operation) {\n      case Operations.NONE:\n        this.logger.debug('NONE operation');\n        break;\n      case Operations.MOVE:\n        this.logger.debug('MOVE operation');\n        this.move(control)\n        break;\n      case Operations.ROTATE:\n        this.logger.debug('ROTATE operation');\n        this.rotate(control)\n        break;\n      case Operations.SHOOT:\n        debugger\n        this.logger.debug('SHOOT operation')\n        return new Misile(this.x, this.y, this.angle, 1, this.width, this.height)\n      default:\n        this.logger.debug('NOOP')\n    }\n\n    return null;\n  }\n\n  rotate(control) {\n    if (control.angle !== 90 && control.angle !== 180 && control.angle !== 270 &&\n        control.angle !== -90 && control.angle !== -180 && control.angle !== -270) {\n          console.error('angle should be +-(90,180,270)')\n    } else {\n      this.angle += control.angle\n      this.angle = Utils.normalizeAngle(this.angle)\n    }\n  }\n\n  move(control) {\n    switch(this.angle) {\n      case 0:\n        if (this.x + control.velocity < this.width) {\n          this.x += control.velocity\n        }\n        break\n      case 180:\n        if (this.x - control.velocity >= 0) {\n          this.x -= control.velocity\n        }\n        break\n      case 90:\n        if (this.y - control.velocity >= 0) {\n          this.y -= control.velocity\n        }\n        break\n      case 270:\n        if (this.y + control.velocity < this.height) {\n          this.y += control.velocity\n        }\n        break\n    }\n  }\n}\n\nmodule.exports = InternalPlayer","class Misile {\n  constructor(x, y, angle, velocity, width, height) {\n    this.x = x\n    this.y = y\n    this.angle = angle\n    this.velocity = velocity\n    this.width = width\n    this.height = height\n  }\n\n  calculatePath() {\n    let path = []\n\n    if (this.angle === 0) {\n      let currentX = this.x\n\n      while (currentX < width) {\n        path.push({ x: currentX, y })\n        currentX++\n      }\n    }\n    if (this.angle === 90) {\n      let currentY = this.y\n\n      while (currentY > 0) {\n        path.push({ x, y: currentY })\n        currentY--\n      }\n    }\n    if (this.angle === 180) {\n      let currentX = this.x\n\n      while (currentX > 0) {\n        path.push({ x: currentX, y })\n        currentX--\n      }\n    }\n    if (this.angle === 270) {\n      let currentY = this.y\n\n      while (currentY < height) {\n        path.push({ x, y: currentY })\n        currentY++\n      }\n    }\n\n\n  }\n}\n\nmodule.exports = Misile","const GameSnapshot = require('../core/GameSnapshot.js')\n\nclass WebDrawer {\n  constructor(players, board) {\n    this.board = null\n    this.players = null\n    this.objects = null\n\n    // TODO: externalize this\n    this.c = document.getElementById(\"myCanvas\");\n    this.ctx = this.c.getContext(\"2d\");\n  }\n\n  init(players, board, objects) {\n    this.board = board\n    this.players = players\n    this.objects = objects\n  }\n\n  draw() {\n    this.ctx.clearRect(0, 0, this.ctx.width, this.ctx.height)\n\n    if (this.objects !== null) {\n      this.objects.forEach(object => {\n        if (typeof object === 'Misile') {\n          console.log('FOUND MISILE!!')\n        }\n      })\n    }\n\n    for (let i = 0; i<this.board.length; i++) {\n      for (let j = 0; j<this.board[i].length; j++) {\n        // console.log(' # ')\n        let player = this.anyPlayer(j, i)\n        if (player) {\n          this.ctx.fillStyle = \"#00FF00\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          // this.ctx.drawImage(drawing,j*70, i*70, 70, 70);\n\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/players/tank.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 20, 20);\n          }\n\n          if (player.angle === 0) {\n            // process.stdout.write(' > ')\n          }\n          if (player.angle === 90) {\n            // process.stdout.write(' ^ ')\n          }\n          if (player.angle === 180) {\n            // process.stdout.write(' < ')\n          }\n          if (player.angle === 270) {\n            // process.stdout.write(' v ')\n          }\n        } else {\n          this.ctx.fillStyle = \"#FF0000\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/sand/slice33_33.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 50, 50);\n          }\n\n          // process.stdout.write(' # ')\n        }\n      }\n      // console.log('')\n    }\n  }\n\n  draw2(gameSnapshot) {\n    this.ctx.clearRect(0, 0, this.ctx.width, this.ctx.height)\n\n    if (gameSnapshot.objects !== null && gameSnapshot.objects.length > 0) {\n      gameSnapshot.objects.forEach(object => {\n        if (typeof object === 'Misile') {\n          console.log('FOUND MISILE!!')\n        }\n      })\n    }\n\n    for (let i = 0; i<this.board.length; i++) {\n      for (let j = 0; j<this.board[i].length; j++) {\n        // console.log(' # ')\n        let player = this.anyPlayer(j, i)\n        if (player) {\n          this.ctx.fillStyle = \"#00FF00\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          // this.ctx.drawImage(drawing,j*70, i*70, 70, 70);\n\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/players/tank.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 20, 20);\n          }\n\n          if (player.angle === 0) {\n            // process.stdout.write(' > ')\n          }\n          if (player.angle === 90) {\n            // process.stdout.write(' ^ ')\n          }\n          if (player.angle === 180) {\n            // process.stdout.write(' < ')\n          }\n          if (player.angle === 270) {\n            // process.stdout.write(' v ')\n          }\n        } else {\n          this.ctx.fillStyle = \"#FF0000\"\n          // this.ctx.fillRect(j*10+1, i*10+1, 8, 8 )\n          let drawing = new Image()\n          drawing.src = \"http://localhost:8080/img/sand/slice33_33.png\"\n          drawing.onload = () => {\n            this.ctx.drawImage(drawing,j*70+1, i*70+1, 50, 50);\n          }\n\n          // process.stdout.write(' # ')\n        }\n      }\n      // console.log('')\n    }\n  }\n\n  anyPlayer(x, y) {\n    return this.players.find(p => p.x == x && p.y == y)\n  }\n}\n\nmodule.exports = WebDrawer","const INFO = 3\nconst DEBUG = 2\n\nclass Logger {\n  constructor(idHtmlLog, level) {\n    this.el = document.getElementById(idHtmlLog)\n    this.level = level\n    this.msgs = []\n  }\n\n  info(msg) {\n    this.msgs.push({ level: INFO, msg: msg })\n    this.flush()\n  }\n\n  debug(msg) {\n    this.msgs.push({ level: DEBUG, msg: msg })\n    this.flush()\n  }\n\n  flush() {\n    this.msgs.forEach(msg => this.el.innerHTML += `${msg.level}: ${msg.msg}\\n`)\n    this.el.scrollTop = this.el.scrollHeight;\n    this.msgs = []\n  }\n}\n\nmodule.exports = Logger","const Utils = require('../utils/Utils')\n\nclass SamplePlayer {\n  constructor() {\n    this.turnNumber = 0\n  }\n\n  init() {\n    console.log(`init`)\n  }\n\n  turn(control) {\n    console.log(`turn`)\n\n    if (this.turnNumber % 4 === 0) {\n      control.rotate(90)\n    } else {\n      control.shoot()\n    }\n\n    this.turnNumber++\n  }\n}\n\nmodule.exports = SamplePlayer","function randomInt(max) {\n  return parseInt(Math.random() * max)\n}\n\nfunction normalizeAngle(angle) {\n  if (angle >= 360) {\n    return angle - 360\n  }\n  if (angle < 0) {\n    return 360 - angle\n  }\n\n  return angle\n}\n\nfunction createMultiArray(width, height) {\n  let row = new Array(width).fill(0)\n  let array = new Array(height).fill(row)\n\n  return array\n}\n\nmodule.exports = { randomInt, normalizeAngle, createMultiArray }","const Game = require('./core/Game.js')\nconst WebDrawer = require('./drawers/WebDrawer.js')\nconst SamplePlayer = require('./players/sample-player.js')\nconst Logger = require('./log/Logger.js')\n\n// console.log('Started...')\n\n// let game = new Game(new WebDrawer())\n\n// // add players\n// game.addPlayer(new SamplePlayer())\n// game.addPlayer(new SamplePlayer())\n\n// // init\n// game.init()\n\n// // start\n// game.start()\n\nmodule.exports = { Game, WebDrawer, SamplePlayer, Logger }\n\n// module.exports = {\n//   Game: require('./core/Game.js')\n// }\n\n// exports.Game = require('./core/Game.js')\n\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29yZS9Db250cm9sLmpzIiwic3JjL2NvcmUvR2FtZS5qcyIsInNyYy9jb3JlL0dhbWVTbmFwc2hvdC5qcyIsInNyYy9jb3JlL0ludGVybmFsUGxheWVyLmpzIiwic3JjL2NvcmUvTWlzaWxlLmpzIiwic3JjL2RyYXdlcnMvV2ViRHJhd2VyLmpzIiwic3JjL2xvZy9Mb2dnZXIuanMiLCJzcmMvcGxheWVycy9zYW1wbGUtcGxheWVyLmpzIiwic3JjL3V0aWxzL1V0aWxzLmpzIiwic3JjL3dlYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgT3BlcmF0aW9ucyA9IHtcbiAgTk9ORTogJ25vbmUnLFxuICBNT1ZFOiAnbW92ZScsXG4gIFJPVEFURTogJ3JvdGF0ZScsXG4gIFNIT09UOiAnc2hvb3QnXG59XG5cbmNsYXNzIENvbnRyb2wge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYW5nbGUgPSAwXG4gICAgdGhpcy52ZWxvY2l0eSA9IDBcbiAgICB0aGlzLm9wZXJhdGlvbiA9IE9wZXJhdGlvbnMuTk9ORVxuICB9XG5cbiAgbW92ZSh2ZWxvY2l0eSkge1xuICAgIHRoaXMudmVsb2NpdHkgPSB2ZWxvY2l0eVxuICAgIHRoaXMub3BlcmF0aW9uID0gT3BlcmF0aW9ucy5NT1ZFXG4gIH1cblxuICByb3RhdGUoYW5nbGUpIHtcbiAgICB0aGlzLmFuZ2xlICs9IGFuZ2xlXG4gICAgdGhpcy5vcGVyYXRpb24gPSBPcGVyYXRpb25zLlJPVEFURVxuICB9XG5cbiAgc2hvb3QoKSB7XG4gICAgdGhpcy5vcGVyYXRpb24gPSBPcGVyYXRpb25zLlNIT09UXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIENvbnRyb2wsIE9wZXJhdGlvbnNcbn0iLCIvLyBpbXBvcnQgeyBTYW1wbGVQbGF5ZXIgfSBmcm9tIFwiLi4vcGxheWVycy9zYW1wbGUtcGxheWVyXCJcbmNvbnN0IEludGVybmFsUGxheWVyID0gcmVxdWlyZSgnLi9JbnRlcm5hbFBsYXllcicpXG5jb25zdCBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL1V0aWxzJylcbmNvbnN0IFNhbXBsZVBsYXllciA9IHJlcXVpcmUoJy4uL3BsYXllcnMvc2FtcGxlLXBsYXllcicpXG5jb25zdCBHYW1lU25hcHNob3QgPSByZXF1aXJlKCcuL0dhbWVTbmFwc2hvdC5qcycpXG5cbmNsYXNzIEdhbWUge1xuICBjb25zdHJ1Y3RvcihkcmF3ZXIsIGxvZ2dlcikge1xuICAgIHRoaXMucGxheWVycyA9IFtdXG4gICAgdGhpcy5ib2FyZCA9IFV0aWxzLmNyZWF0ZU11bHRpQXJyYXkoOCw1KVxuICAgIHRoaXMub2JqZWN0cyA9IFtdXG5cbiAgICB0aGlzLmRyYXdlciA9IGRyYXdlclxuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyXG4gICAgdGhpcy5wYXVzZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5kZWQgPSBmYWxzZVxuICAgIHRoaXMudHVybk51bWJlciA9IDBcbiAgfVxuXG4gIGFkZFBsYXllcihwbGF5ZXIpIHtcbiAgICB0aGlzLnBsYXllcnMucHVzaChcbiAgICAgIG5ldyBJbnRlcm5hbFBsYXllcihwbGF5ZXIsIHRoaXMuYm9hcmRbMF0ubGVuZ3RoLCB0aGlzLmJvYXJkLmxlbmd0aCwgdGhpcy5sb2dnZXIpXG4gICAgKVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdHQU1FIElOSVQnKVxuXG4gICAgdGhpcy5wbGF5ZXJzLmZvckVhY2gocCA9PiBwLmRvSW5pdChcbiAgICAgIFV0aWxzLnJhbmRvbUludCh0aGlzLmJvYXJkLmxlbmd0aCksXG4gICAgICBVdGlscy5yYW5kb21JbnQodGhpcy5ib2FyZC5sZW5ndGgpLFxuICAgICAgMTAwXG4gICAgKSlcblxuICAgIHRoaXMuZHJhd2VyLmluaXQodGhpcy5wbGF5ZXJzLCB0aGlzLmJvYXJkLCB0aGlzLm9iamVjdHMpXG4gIH1cblxuICBhc3luYyBzdGFydCgpIHtcbiAgICBjb25zb2xlLmxvZygnR0FNRSBTVEFSVCcpXG5cbiAgICB3aGlsZSAoIXRoaXMuZW5kZWQpIHtcbiAgICAgIHRoaXMudHVybigpXG5cbiAgICAgIHRoaXMudHVybk51bWJlcisrXG4gICAgICAvLyBpZiAodGhpcy50dXJuTnVtYmVyID4gMTApIHtcbiAgICAgIC8vICAgdGhpcy5lbmRlZCA9IHRydWVcbiAgICAgIC8vIH1cbiAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwMClcbiAgICB9XG4gIH1cblxuICBuZXh0VGljaygpIHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgVFVSTiAke3RoaXMudHVybk51bWJlcn1gKVxuXG4gICAgdGhpcy50dXJuKClcblxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBPQkpFQ1RTICR7dGhpcy5vYmplY3RzfWApXG5cbiAgICB0aGlzLnR1cm5OdW1iZXIrK1xuICB9XG5cbiAgc2xlZXAobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpO1xuICAgIH0pO1xuICB9XG5cbiAgcGF1c2UoKSB7XG4gICAgdGhpcy5wYXVzZWQgPSB0cnVlXG4gIH1cblxuICB0dXJuKCkge1xuICAgIHRoaXMub2JqZWN0cyA9IFtdXG5cbiAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHtcbiAgICAgIGxldCByZXN1bHQgPSBwLmRvVHVybigpXG5cbiAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2gocmVzdWx0KVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLmRyYXdlci5kcmF3MihuZXcgR2FtZVNuYXBzaG90KHRoaXMucGxheWVycywgdGhpcy5ib2FyZCwgdGhpcy5vYmplY3RzKSlcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWUiLCJjbGFzcyBHYW1lU25hcHNob3Qge1xuICBjb25zdHJ1Y3RvcihwbGF5ZXJzLCBib2FyZCwgb2JqZWN0cykge1xuICAgIHRoaXMucGxheWVycyA9IHBsYXllcnNcbiAgICB0aGlzLmJvYXJkID0gYm9hcmRcbiAgICB0aGlzLm9iamVjdHMgPSBvYmplY3RzXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lU25hcHNob3QiLCJjb25zdCB7IENvbnRyb2wsIE9wZXJhdGlvbnMgfSA9IHJlcXVpcmUoJy4vQ29udHJvbCcpXG5jb25zdCBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL1V0aWxzJylcbmNvbnN0IE1pc2lsZSA9IHJlcXVpcmUoJy4vTWlzaWxlJylcblxuY2xhc3MgSW50ZXJuYWxQbGF5ZXIge1xuICBjb25zdHJ1Y3RvcihwbGF5ZXIsIHdpZHRoLCBoZWlnaHQsIGxvZ2dlcikge1xuICAgIHRoaXMueCA9IDBcbiAgICB0aGlzLnkgPSAwXG4gICAgdGhpcy5hbmdsZSA9IDBcbiAgICB0aGlzLmxpZmUgPSAxMDBcbiAgICB0aGlzLndpZHRoID0gd2lkdGhcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodFxuICAgIHRoaXMucGxheWVyID0gcGxheWVyXG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXJcbiAgfVxuXG4gIGRvSW5pdCh4LCB5LCBsaWZlKSB7XG4gICAgdGhpcy54ID0geFxuICAgIHRoaXMueSA9IHlcbiAgICB0aGlzLmxpZmUgPSBsaWZlXG4gICAgdGhpcy5wbGF5ZXIuaW5pdCgpXG4gIH1cblxuICBkb1R1cm4oKSB7XG4gICAgbGV0IGNvbnRyb2wgPSBuZXcgQ29udHJvbCgpXG4gICAgdGhpcy5wbGF5ZXIudHVybihjb250cm9sKVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYENPTlRST0wgJHtKU09OLnN0cmluZ2lmeShjb250cm9sKX1gKVxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBQTEFZRVIgJHtKU09OLnN0cmluZ2lmeSh0aGlzKX1gKVxuXG4gICAgc3dpdGNoKGNvbnRyb2wub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlIE9wZXJhdGlvbnMuTk9ORTpcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ05PTkUgb3BlcmF0aW9uJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBPcGVyYXRpb25zLk1PVkU6XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdNT1ZFIG9wZXJhdGlvbicpO1xuICAgICAgICB0aGlzLm1vdmUoY29udHJvbClcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIE9wZXJhdGlvbnMuUk9UQVRFOlxuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnUk9UQVRFIG9wZXJhdGlvbicpO1xuICAgICAgICB0aGlzLnJvdGF0ZShjb250cm9sKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgT3BlcmF0aW9ucy5TSE9PVDpcbiAgICAgICAgZGVidWdnZXJcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ1NIT09UIG9wZXJhdGlvbicpXG4gICAgICAgIHJldHVybiBuZXcgTWlzaWxlKHRoaXMueCwgdGhpcy55LCB0aGlzLmFuZ2xlLCAxLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodClcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdOT09QJylcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJvdGF0ZShjb250cm9sKSB7XG4gICAgaWYgKGNvbnRyb2wuYW5nbGUgIT09IDkwICYmIGNvbnRyb2wuYW5nbGUgIT09IDE4MCAmJiBjb250cm9sLmFuZ2xlICE9PSAyNzAgJiZcbiAgICAgICAgY29udHJvbC5hbmdsZSAhPT0gLTkwICYmIGNvbnRyb2wuYW5nbGUgIT09IC0xODAgJiYgY29udHJvbC5hbmdsZSAhPT0gLTI3MCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2FuZ2xlIHNob3VsZCBiZSArLSg5MCwxODAsMjcwKScpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYW5nbGUgKz0gY29udHJvbC5hbmdsZVxuICAgICAgdGhpcy5hbmdsZSA9IFV0aWxzLm5vcm1hbGl6ZUFuZ2xlKHRoaXMuYW5nbGUpXG4gICAgfVxuICB9XG5cbiAgbW92ZShjb250cm9sKSB7XG4gICAgc3dpdGNoKHRoaXMuYW5nbGUpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgaWYgKHRoaXMueCArIGNvbnRyb2wudmVsb2NpdHkgPCB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgdGhpcy54ICs9IGNvbnRyb2wudmVsb2NpdHlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAxODA6XG4gICAgICAgIGlmICh0aGlzLnggLSBjb250cm9sLnZlbG9jaXR5ID49IDApIHtcbiAgICAgICAgICB0aGlzLnggLT0gY29udHJvbC52ZWxvY2l0eVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIDkwOlxuICAgICAgICBpZiAodGhpcy55IC0gY29udHJvbC52ZWxvY2l0eSA+PSAwKSB7XG4gICAgICAgICAgdGhpcy55IC09IGNvbnRyb2wudmVsb2NpdHlcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAyNzA6XG4gICAgICAgIGlmICh0aGlzLnkgKyBjb250cm9sLnZlbG9jaXR5IDwgdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgICB0aGlzLnkgKz0gY29udHJvbC52ZWxvY2l0eVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gSW50ZXJuYWxQbGF5ZXIiLCJjbGFzcyBNaXNpbGUge1xuICBjb25zdHJ1Y3Rvcih4LCB5LCBhbmdsZSwgdmVsb2NpdHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICB0aGlzLnggPSB4XG4gICAgdGhpcy55ID0geVxuICAgIHRoaXMuYW5nbGUgPSBhbmdsZVxuICAgIHRoaXMudmVsb2NpdHkgPSB2ZWxvY2l0eVxuICAgIHRoaXMud2lkdGggPSB3aWR0aFxuICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0XG4gIH1cblxuICBjYWxjdWxhdGVQYXRoKCkge1xuICAgIGxldCBwYXRoID0gW11cblxuICAgIGlmICh0aGlzLmFuZ2xlID09PSAwKSB7XG4gICAgICBsZXQgY3VycmVudFggPSB0aGlzLnhcblxuICAgICAgd2hpbGUgKGN1cnJlbnRYIDwgd2lkdGgpIHtcbiAgICAgICAgcGF0aC5wdXNoKHsgeDogY3VycmVudFgsIHkgfSlcbiAgICAgICAgY3VycmVudFgrK1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5hbmdsZSA9PT0gOTApIHtcbiAgICAgIGxldCBjdXJyZW50WSA9IHRoaXMueVxuXG4gICAgICB3aGlsZSAoY3VycmVudFkgPiAwKSB7XG4gICAgICAgIHBhdGgucHVzaCh7IHgsIHk6IGN1cnJlbnRZIH0pXG4gICAgICAgIGN1cnJlbnRZLS1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuYW5nbGUgPT09IDE4MCkge1xuICAgICAgbGV0IGN1cnJlbnRYID0gdGhpcy54XG5cbiAgICAgIHdoaWxlIChjdXJyZW50WCA+IDApIHtcbiAgICAgICAgcGF0aC5wdXNoKHsgeDogY3VycmVudFgsIHkgfSlcbiAgICAgICAgY3VycmVudFgtLVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5hbmdsZSA9PT0gMjcwKSB7XG4gICAgICBsZXQgY3VycmVudFkgPSB0aGlzLnlcblxuICAgICAgd2hpbGUgKGN1cnJlbnRZIDwgaGVpZ2h0KSB7XG4gICAgICAgIHBhdGgucHVzaCh7IHgsIHk6IGN1cnJlbnRZIH0pXG4gICAgICAgIGN1cnJlbnRZKytcbiAgICAgIH1cbiAgICB9XG5cblxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTWlzaWxlIiwiY29uc3QgR2FtZVNuYXBzaG90ID0gcmVxdWlyZSgnLi4vY29yZS9HYW1lU25hcHNob3QuanMnKVxuXG5jbGFzcyBXZWJEcmF3ZXIge1xuICBjb25zdHJ1Y3RvcihwbGF5ZXJzLCBib2FyZCkge1xuICAgIHRoaXMuYm9hcmQgPSBudWxsXG4gICAgdGhpcy5wbGF5ZXJzID0gbnVsbFxuICAgIHRoaXMub2JqZWN0cyA9IG51bGxcblxuICAgIC8vIFRPRE86IGV4dGVybmFsaXplIHRoaXNcbiAgICB0aGlzLmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm15Q2FudmFzXCIpO1xuICAgIHRoaXMuY3R4ID0gdGhpcy5jLmdldENvbnRleHQoXCIyZFwiKTtcbiAgfVxuXG4gIGluaXQocGxheWVycywgYm9hcmQsIG9iamVjdHMpIHtcbiAgICB0aGlzLmJvYXJkID0gYm9hcmRcbiAgICB0aGlzLnBsYXllcnMgPSBwbGF5ZXJzXG4gICAgdGhpcy5vYmplY3RzID0gb2JqZWN0c1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jdHgud2lkdGgsIHRoaXMuY3R4LmhlaWdodClcblxuICAgIGlmICh0aGlzLm9iamVjdHMgIT09IG51bGwpIHtcbiAgICAgIHRoaXMub2JqZWN0cy5mb3JFYWNoKG9iamVjdCA9PiB7XG4gICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0ID09PSAnTWlzaWxlJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGT1VORCBNSVNJTEUhIScpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGk8dGhpcy5ib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGo8dGhpcy5ib2FyZFtpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnICMgJylcbiAgICAgICAgbGV0IHBsYXllciA9IHRoaXMuYW55UGxheWVyKGosIGkpXG4gICAgICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcIiMwMEZGMDBcIlxuICAgICAgICAgIC8vIHRoaXMuY3R4LmZpbGxSZWN0KGoqMTArMSwgaSoxMCsxLCA4LCA4IClcbiAgICAgICAgICAvLyB0aGlzLmN0eC5kcmF3SW1hZ2UoZHJhd2luZyxqKjcwLCBpKjcwLCA3MCwgNzApO1xuXG4gICAgICAgICAgbGV0IGRyYXdpbmcgPSBuZXcgSW1hZ2UoKVxuICAgICAgICAgIGRyYXdpbmcuc3JjID0gXCJodHRwOi8vbG9jYWxob3N0OjgwODAvaW1nL3BsYXllcnMvdGFuay5wbmdcIlxuICAgICAgICAgIGRyYXdpbmcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGRyYXdpbmcsaio3MCsxLCBpKjcwKzEsIDIwLCAyMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMCkge1xuICAgICAgICAgICAgLy8gcHJvY2Vzcy5zdGRvdXQud3JpdGUoJyA+ICcpXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwbGF5ZXIuYW5nbGUgPT09IDkwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIF4gJylcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMTgwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIDwgJylcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gMjcwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnIHYgJylcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gXCIjRkYwMDAwXCJcbiAgICAgICAgICAvLyB0aGlzLmN0eC5maWxsUmVjdChqKjEwKzEsIGkqMTArMSwgOCwgOCApXG4gICAgICAgICAgbGV0IGRyYXdpbmcgPSBuZXcgSW1hZ2UoKVxuICAgICAgICAgIGRyYXdpbmcuc3JjID0gXCJodHRwOi8vbG9jYWxob3N0OjgwODAvaW1nL3NhbmQvc2xpY2UzM18zMy5wbmdcIlxuICAgICAgICAgIGRyYXdpbmcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGRyYXdpbmcsaio3MCsxLCBpKjcwKzEsIDUwLCA1MCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcHJvY2Vzcy5zdGRvdXQud3JpdGUoJyAjICcpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKCcnKVxuICAgIH1cbiAgfVxuXG4gIGRyYXcyKGdhbWVTbmFwc2hvdCkge1xuICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmN0eC53aWR0aCwgdGhpcy5jdHguaGVpZ2h0KVxuXG4gICAgaWYgKGdhbWVTbmFwc2hvdC5vYmplY3RzICE9PSBudWxsICYmIGdhbWVTbmFwc2hvdC5vYmplY3RzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdhbWVTbmFwc2hvdC5vYmplY3RzLmZvckVhY2gob2JqZWN0ID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYmplY3QgPT09ICdNaXNpbGUnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZPVU5EIE1JU0lMRSEhJylcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaTx0aGlzLmJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgajx0aGlzLmJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCcgIyAnKVxuICAgICAgICBsZXQgcGxheWVyID0gdGhpcy5hbnlQbGF5ZXIoaiwgaSlcbiAgICAgICAgaWYgKHBsYXllcikge1xuICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IFwiIzAwRkYwMFwiXG4gICAgICAgICAgLy8gdGhpcy5jdHguZmlsbFJlY3QoaioxMCsxLCBpKjEwKzEsIDgsIDggKVxuICAgICAgICAgIC8vIHRoaXMuY3R4LmRyYXdJbWFnZShkcmF3aW5nLGoqNzAsIGkqNzAsIDcwLCA3MCk7XG5cbiAgICAgICAgICBsZXQgZHJhd2luZyA9IG5ldyBJbWFnZSgpXG4gICAgICAgICAgZHJhd2luZy5zcmMgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9pbWcvcGxheWVycy90YW5rLnBuZ1wiXG4gICAgICAgICAgZHJhd2luZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UoZHJhd2luZyxqKjcwKzEsIGkqNzArMSwgMjAsIDIwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocGxheWVyLmFuZ2xlID09PSAwKSB7XG4gICAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnID4gJylcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBsYXllci5hbmdsZSA9PT0gOTApIHtcbiAgICAgICAgICAgIC8vIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCcgXiAnKVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocGxheWVyLmFuZ2xlID09PSAxODApIHtcbiAgICAgICAgICAgIC8vIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCcgPCAnKVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocGxheWVyLmFuZ2xlID09PSAyNzApIHtcbiAgICAgICAgICAgIC8vIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCcgdiAnKVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcIiNGRjAwMDBcIlxuICAgICAgICAgIC8vIHRoaXMuY3R4LmZpbGxSZWN0KGoqMTArMSwgaSoxMCsxLCA4LCA4IClcbiAgICAgICAgICBsZXQgZHJhd2luZyA9IG5ldyBJbWFnZSgpXG4gICAgICAgICAgZHJhd2luZy5zcmMgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9pbWcvc2FuZC9zbGljZTMzXzMzLnBuZ1wiXG4gICAgICAgICAgZHJhd2luZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UoZHJhd2luZyxqKjcwKzEsIGkqNzArMSwgNTAsIDUwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBwcm9jZXNzLnN0ZG91dC53cml0ZSgnICMgJylcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2coJycpXG4gICAgfVxuICB9XG5cbiAgYW55UGxheWVyKHgsIHkpIHtcbiAgICByZXR1cm4gdGhpcy5wbGF5ZXJzLmZpbmQocCA9PiBwLnggPT0geCAmJiBwLnkgPT0geSlcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFdlYkRyYXdlciIsImNvbnN0IElORk8gPSAzXG5jb25zdCBERUJVRyA9IDJcblxuY2xhc3MgTG9nZ2VyIHtcbiAgY29uc3RydWN0b3IoaWRIdG1sTG9nLCBsZXZlbCkge1xuICAgIHRoaXMuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZEh0bWxMb2cpXG4gICAgdGhpcy5sZXZlbCA9IGxldmVsXG4gICAgdGhpcy5tc2dzID0gW11cbiAgfVxuXG4gIGluZm8obXNnKSB7XG4gICAgdGhpcy5tc2dzLnB1c2goeyBsZXZlbDogSU5GTywgbXNnOiBtc2cgfSlcbiAgICB0aGlzLmZsdXNoKClcbiAgfVxuXG4gIGRlYnVnKG1zZykge1xuICAgIHRoaXMubXNncy5wdXNoKHsgbGV2ZWw6IERFQlVHLCBtc2c6IG1zZyB9KVxuICAgIHRoaXMuZmx1c2goKVxuICB9XG5cbiAgZmx1c2goKSB7XG4gICAgdGhpcy5tc2dzLmZvckVhY2gobXNnID0+IHRoaXMuZWwuaW5uZXJIVE1MICs9IGAke21zZy5sZXZlbH06ICR7bXNnLm1zZ31cXG5gKVxuICAgIHRoaXMuZWwuc2Nyb2xsVG9wID0gdGhpcy5lbC5zY3JvbGxIZWlnaHQ7XG4gICAgdGhpcy5tc2dzID0gW11cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IExvZ2dlciIsImNvbnN0IFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvVXRpbHMnKVxuXG5jbGFzcyBTYW1wbGVQbGF5ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnR1cm5OdW1iZXIgPSAwXG4gIH1cblxuICBpbml0KCkge1xuICAgIGNvbnNvbGUubG9nKGBpbml0YClcbiAgfVxuXG4gIHR1cm4oY29udHJvbCkge1xuICAgIGNvbnNvbGUubG9nKGB0dXJuYClcblxuICAgIGlmICh0aGlzLnR1cm5OdW1iZXIgJSA0ID09PSAwKSB7XG4gICAgICBjb250cm9sLnJvdGF0ZSg5MClcbiAgICB9IGVsc2Uge1xuICAgICAgY29udHJvbC5zaG9vdCgpXG4gICAgfVxuXG4gICAgdGhpcy50dXJuTnVtYmVyKytcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNhbXBsZVBsYXllciIsImZ1bmN0aW9uIHJhbmRvbUludChtYXgpIHtcbiAgcmV0dXJuIHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiBtYXgpXG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUFuZ2xlKGFuZ2xlKSB7XG4gIGlmIChhbmdsZSA+PSAzNjApIHtcbiAgICByZXR1cm4gYW5nbGUgLSAzNjBcbiAgfVxuICBpZiAoYW5nbGUgPCAwKSB7XG4gICAgcmV0dXJuIDM2MCAtIGFuZ2xlXG4gIH1cblxuICByZXR1cm4gYW5nbGVcbn1cblxuZnVuY3Rpb24gY3JlYXRlTXVsdGlBcnJheSh3aWR0aCwgaGVpZ2h0KSB7XG4gIGxldCByb3cgPSBuZXcgQXJyYXkod2lkdGgpLmZpbGwoMClcbiAgbGV0IGFycmF5ID0gbmV3IEFycmF5KGhlaWdodCkuZmlsbChyb3cpXG5cbiAgcmV0dXJuIGFycmF5XG59XG5cbm1vZHVsZS5leHBvcnRzID0geyByYW5kb21JbnQsIG5vcm1hbGl6ZUFuZ2xlLCBjcmVhdGVNdWx0aUFycmF5IH0iLCJjb25zdCBHYW1lID0gcmVxdWlyZSgnLi9jb3JlL0dhbWUuanMnKVxuY29uc3QgV2ViRHJhd2VyID0gcmVxdWlyZSgnLi9kcmF3ZXJzL1dlYkRyYXdlci5qcycpXG5jb25zdCBTYW1wbGVQbGF5ZXIgPSByZXF1aXJlKCcuL3BsYXllcnMvc2FtcGxlLXBsYXllci5qcycpXG5jb25zdCBMb2dnZXIgPSByZXF1aXJlKCcuL2xvZy9Mb2dnZXIuanMnKVxuXG4vLyBjb25zb2xlLmxvZygnU3RhcnRlZC4uLicpXG5cbi8vIGxldCBnYW1lID0gbmV3IEdhbWUobmV3IFdlYkRyYXdlcigpKVxuXG4vLyAvLyBhZGQgcGxheWVyc1xuLy8gZ2FtZS5hZGRQbGF5ZXIobmV3IFNhbXBsZVBsYXllcigpKVxuLy8gZ2FtZS5hZGRQbGF5ZXIobmV3IFNhbXBsZVBsYXllcigpKVxuXG4vLyAvLyBpbml0XG4vLyBnYW1lLmluaXQoKVxuXG4vLyAvLyBzdGFydFxuLy8gZ2FtZS5zdGFydCgpXG5cbm1vZHVsZS5leHBvcnRzID0geyBHYW1lLCBXZWJEcmF3ZXIsIFNhbXBsZVBsYXllciwgTG9nZ2VyIH1cblxuLy8gbW9kdWxlLmV4cG9ydHMgPSB7XG4vLyAgIEdhbWU6IHJlcXVpcmUoJy4vY29yZS9HYW1lLmpzJylcbi8vIH1cblxuLy8gZXhwb3J0cy5HYW1lID0gcmVxdWlyZSgnLi9jb3JlL0dhbWUuanMnKVxuXG4iXX0="}